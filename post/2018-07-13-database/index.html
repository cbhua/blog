<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        数据库系统概论复习笔记 - Timegg
      </title>
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  
  <meta name="theme-color" content="#000000" />
  
  <meta http-equiv="window-target" content="_top" />
  
  
  <meta name="description" content="大三上学期课程：数据库系统概论期末复习过程中的一些笔记。" />
  <meta name="generator" content="Hugo 0.69.0 with theme pure" />
  <title>数据库系统概论复习笔记 - Timegg</title>
  
  
  <link rel="stylesheet" href="https://chuanbohua.github.io/css/style.min.5b4c067c98e322626060c3037927c72fec8325ef47442db2f15558981536a23e.css">
  
  <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css" async>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
  <meta property="og:title" content="数据库系统概论复习笔记" />
<meta property="og:description" content="大三上学期课程：数据库系统概论期末复习过程中的一些笔记。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chuanbohua.github.io/post/2018-07-13-database/" />
<meta property="article:published_time" content="2018-06-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-06-12T00:00:00+00:00" />
<meta itemprop="name" content="数据库系统概论复习笔记">
<meta itemprop="description" content="大三上学期课程：数据库系统概论期末复习过程中的一些笔记。">
<meta itemprop="datePublished" content="2018-06-12T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-06-12T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="6993">



<meta itemprop="keywords" content="SQL,Database," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="数据库系统概论复习笔记"/>
<meta name="twitter:description" content="大三上学期课程：数据库系统概论期末复习过程中的一些笔记。"/>

  <!--[if lte IE 9]>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
    <![endif]-->

  <!--[if lt IE 9]>
      <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->


  
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?329fd26ee41f86707c3f7e99ff3405c8";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
</head>
  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="https://timegg.top/" target="_blank">
            <img class="img-circle img-rotate" src="https://chuanbohua.github.io/avatar.jpg" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">Chuanbo HUA</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">HIT, KAIST</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Daejeon, South Korea</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="Type something..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/post/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Archives</span>
                </a>
            </li>
            <li class="menu-item menu-item-categories">
                <a href="/categories/">
                    <i class="icon icon-folder"></i>
                  <span class="menu-title">Categories</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
            <li class="menu-item menu-item-links">
                <a href="/links/">
                    <i class="icon icon-friendship"></i>
                  <span class="menu-title">Links</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content"><p><img id='board-img' src="https://chuanbohua.github.io/img/favicon.png"  alt="logo-timegg" /><br>Timegg has been renewed at 2020.04. Welcome!</p>
            </div>
        </div>
    </div>
</div>

      <div class="widget">
    <h3 class="widget-title"> Categories</h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="https://chuanbohua.github.io/categories/dairy/" class="category-list-link">dairy</a><span class="category-list-count">9</span></li>
            <li class="category-list-item"><a href="https://chuanbohua.github.io/categories/essay/" class="category-list-link">essay</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://chuanbohua.github.io/categories/lecture/" class="category-list-link">lecture</a><span class="category-list-count">13</span></li>
            <li class="category-list-item"><a href="https://chuanbohua.github.io/categories/read/" class="category-list-link">read</a><span class="category-list-count">8</span></li>
            <li class="category-list-item"><a href="https://chuanbohua.github.io/categories/store/" class="category-list-link">store</a><span class="category-list-count">4</span></li>
            <li class="category-list-item"><a href="https://chuanbohua.github.io/categories/tutorial/" class="category-list-link">tutorial</a><span class="category-list-count">9</span></li>
        </ul>
    </div>
</div>
      
<div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li class="recent-post-li">
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://chuanbohua.github.io/post/2020-09-08-night/" class="title">森见登美彦作品《夜行》</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-09-08 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-09-08</time>
                    </p>
                </div>
            </li>
            <li class="recent-post-li">
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://chuanbohua.github.io/post/2020-09-03-go-to-korea/" class="title">开学流水账</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-09-03 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-09-03</time>
                    </p>
                </div>
            </li>
            <li class="recent-post-li">
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://chuanbohua.github.io/post/2020-07-22-board-game/" class="title">桌游的可重复性思考</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-07-22 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-07-22</time>
                    </p>
                </div>
            </li>
            <li class="recent-post-li">
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://chuanbohua.github.io/post/2020-06-22-panzit/" class="title">智云云台 Smooth 4 &amp; M2 简易对比</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-23 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-06-23</time>
                    </p>
                </div>
            </li>
            <li class="recent-post-li">
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://chuanbohua.github.io/post/2020-06-21-steam-controller/" class="title">Steam Controller 简易测评</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-06-22 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-06-22</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>
  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">Catalogue</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>
<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h1 itemprop="name">
  <a
    class="article-title"
    href="/post/2018-07-13-database/"
    >数据库系统概论复习笔记</a
  >
</h1>

      <div class="article-meta">
        
<span class="article-date">
  <i class="icon icon-calendar-check"></i>&nbsp;
<a href="https://chuanbohua.github.io/post/2018-07-13-database/" class="article-date">
  <time datetime="2018-06-12 00:00:00 &#43;0000 UTC" itemprop="datePublished">2018-06-12</time>
</a>
</span>
<span class="article-category">
  <i class="icon icon-folder"></i>&nbsp;
  <a class="article-category-link" href="/categories/lecture/"> Lecture </a>
</span>  
  <span class="article-tag">
    <i class="icon icon-tags"></i>&nbsp;
    <a class="article-tag-link" href="/tags/sql/"> SQL </a>
    <a class="article-tag-link" href="/tags/database/"> Database </a>
  </span>

        <span class="post-comment"><i class="icon icon-comment"></i>&nbsp;<a href="/post/2018-07-13-database/#comments"
            class="article-comment-link">Comments</a></span>
		<span class="post-wordcount hidden-xs" itemprop="wordCount">Word Count: 6993words</span>
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Count: 14minutes </span>
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <h1 id="前言">前言</h1>
<p>这学期参选了数据库系统概论这门课程，虽然最后拿到了还行的成绩，但是因为复习仓促跳过了很多知识点。</p>
<p>由于 9 月要参加计算机四级(数据库)的考试，在这里整理一下复习时的笔记，准备一下计算机四级的考试。</p>
<blockquote>
<p>选用教材：《数据库系统概论（第五版）》高等教育出版社<!-- raw HTML omitted -->ISBN：9787040406641</p>
</blockquote>
<p>作为课程，涉及到的数据库知识比较基础，这里做出概要、关键点笔记和一些理解。</p>
<hr>
<p><strong>2018.10.25 Update</strong> - 数据库四级翻车了。原因是把考纲中 <strong>数据库 + 操作系统原理</strong> 复习成了 <strong>数据库 + 软件工程</strong>，考试时候完全不知道是什么，凭着大一学的一点点操作系统知识……也没有糊过去。等明年 3 月份再参加吧。</p>
<hr>
<p><strong>2019.3.3 Update</strong> - 计算机四级，就和网上说的一样，非常的水。完全没有必要专门复习数据库，只需要背一背题库就可以通过，甚至在对数据库一知半解的情况下也都可以通过。毕竟计算机四级只有选择题，而且题库一般比较固定。</p>
<hr>
<p><strong>2019.08.23 Update</strong> - 计算机四级证书，事实证明，除了混一混学校的评奖加分，没有任何用处。所以我并不推荐专门准备这个，这些时间可以用来干更多有意义的事情。</p>
<h1 id="heading"></h1>
<h2 id="绪论">绪论</h2>
<h3 id="数据库系统概述">数据库系统概述</h3>
<p>数据库的四个基本概念：</p>
<ul>
<li><strong>数据</strong>(data) - 描述事物的符号记录；</li>
<li><strong>数据库</strong>(database, DB) - 长期储存、有组织、可共享的大量数据集合；具有 <em>较小冗余度、较高数据独立性、易扩展性、共享性</em> 的特点；</li>
<li><strong>数据库管理系统</strong>(database management system, DBMS) - 计算机基础软件之一；提供 <em>数据定义语言(DDL)、数据操纵语言(DML)、数据控制语言(DCL)</em> ；</li>
<li><strong>数据库系统</strong>(database system, DBS) - 储存、管理、处理、维护数据的系统；</li>
</ul>
<p>其中数据库系统包含以下部分：</p>
<ul>
<li>数据库(DB)</li>
<li>数据库管理系统(DBMS)</li>
<li>数据库应用程序(DBAP)</li>
<li>数据库管理员(DBA)</li>
</ul>
<p>在不引发混淆的情况下我们称数据库系统为数据库。</p>
<p>数据库发展阶段：人工管理阶段-&gt;文件系统阶段-&gt;数据库系统阶段。</p>
<h3 id="数据模型">数据模型</h3>
<p>数据抽象阶段：现实-&gt;概念模型-&gt;逻辑模型-&gt;物理模型。</p>
<p>概念模型例：实体-联系模型（E-R模型）：</p>
<ul>
<li>实体属性：单值属性/多值属性，基属性/派生属性；</li>
<li>联系类型：内部联系/相互联系，一元联系/二元联系/多元联系，普通联系/递归联系；</li>
</ul>
<p>实体相关的概念对比：</p>
<ul>
<li>实体：客观存在并可以相互区别的事物；</li>
<li>实体属性：实体具有的某一特征；</li>
<li>实体型：实体 + 属性；</li>
<li>实体集：同一类型实体的集合；</li>
</ul>
<p>数据模型的构成：数据结构、数据操作、数据的完整性约束；</p>
<p>常见的数据模型：</p>
<ul>
<li>层次模型 - ex. 树</li>
<li>网状模型 - ex. 图</li>
<li>关系模型 - ex. 表</li>
</ul>
<p>将概念应用于表中：</p>
<ul>
<li>
<p>关系 - 一个表称作一个关系</p>
</li>
<li>
<p>元组 - 行</p>
</li>
<li>
<p>属性 - 列</p>
</li>
<li>
<p>码 - <em>请看后详解</em></p>
</li>
<li>
<p>域 - 属性选区的范围</p>
</li>
<li>
<p>分量 - 元组中的一个</p>
</li>
</ul>
<h3 id="数据库系统结构">数据库系统结构</h3>
<p>数据库系统的三个模式：</p>
<ul>
<li>模式 - 逻辑模式</li>
<li>外模式 - 子模式/用户模式</li>
<li>内模式 - 存储模式</li>
</ul>
<p>数据库系统的三级模式构成两种映像：</p>
<ul>
<li>外模式/模式映像 - 逻辑独立性</li>
<li>模式/内模式映像 - 物理独立性</li>
</ul>
<h2 id="关系数据库">关系数据库</h2>
<p>关系的种类：</p>
<ul>
<li>基本关系：实际表</li>
<li>查询关系：结果表</li>
<li>视图关系：虚拟表</li>
</ul>
<p>关于码：</p>
<ul>
<li>候选码：可以唯一确定元组的一组属性就是<strong>一个</strong>候选码，<em>但其真子集无法唯一确定元组</em> ，候选码中不止一组属性</li>
<li>主码：候选码中任意一组</li>
<li>超码：可以唯一确定元组的一组属性就是一个超码，超码中不止一组属性</li>
<li>外码：属性中引用的其他实体的主码</li>
</ul>
<blockquote>
<p>候选码是最小超码，主码是候选码的其中一个</p>
</blockquote>
<p>关系模式 R(U, D, dom, F)：</p>
<ul>
<li>R：关系名</li>
<li>U：属性名集合</li>
<li>D：相应属性名集合的域</li>
<li>dom：属性和域的映射</li>
<li>F：属性间数据依赖集合</li>
</ul>
<p>关系的完整性：</p>
<ul>
<li>实体完整性：主码不能缺省或非法</li>
<li>参照完整性：外码不能非法</li>
<li>用户定义的完整性：用户定义的数据要求</li>
</ul>
<p>关系操作：</p>
<ul>
<li>集合运算符：交、并、补、差</li>
<li>专门的关系运算符：选择、投影、连接、除</li>
<li>算术比较符：大于、小于、等于、不等于 etc.</li>
<li>逻辑运算符：与、或、非 etc.</li>
</ul>
<blockquote>
<p>关系操作下有相应的 <em>关系代数</em> 和 <em>关系代数表达式</em> ，这部分不再写在这里了，不妨去看看书。</p>
</blockquote>
<h2 id="sql-关系数据库标准语言">SQL 关系数据库标准语言</h2>
<p>SQL 三级结构模式：文件(内模式) -&gt; 表(模式) -&gt; 视图(外模式)。</p>
<p>SQL 实现：数据定义，数据查询，数据更新，数据操作。</p>
<p>SQL 结构框架：</p>
<pre><code>instance // 实例
{
	database // 数据库
	{
		schema // 模式
		{
			table // 表
			view // 视图
			index // 索引
		}
	}
}
</code></pre>
<h3 id="sql-数据定义">SQL 数据定义</h3>
<p><strong>创建模式与删除模式</strong></p>
<p><code>create schema schema_name</code></p>
<p><code>drop schema schema_name &lt;cascade / restricte&gt;</code></p>
<pre><code>// e.g.
create schema test_schame authorization auth_name;
drop schema test_schame cascade;
</code></pre>
<p>关于 cascade &amp; restricte :</p>
<blockquote>
<p>标注 cascade 是级联操作，其操作（例如drop）会对子目录下项目同等操作；</p>
<p>标注 restricte 是限制操作，其操作（例如drop）当子目录下项目非空将报错；</p>
</blockquote>
<p><strong>创建表与删除表</strong></p>
<p><code>create table table_name</code></p>
<p><code>drop table teble_name &lt;cascade / restricte&gt;</code></p>
<pre><code>// e.g.
create table test_table
(
    sno char(10) unique, // 属性名 数据类型 完整性约束
    sname char(10) not null,
    stel char(10),
    dno char(10),

    primary key(sno), // 设置 sno 为主码
    foreign key(dno)
        references test_table2(sno), // 设置 dno 为外码，引用自 test_table2
);

drop table test_table cascade;
</code></pre>
<p><strong>创建视图与删除视图</strong></p>
<p><code>create view view_name</code></p>
<p><code>drop view view_name &lt;cascade / restricte&gt;</code></p>
<pre><code>// e.g.
create view test_view as
select column_name // 涉及到 select 一会再说
from test_table
where condition;

drop view test_view;
</code></pre>
<p><strong>创建索引与删除索引</strong></p>
<p><code>create unique / cluster index index_name</code></p>
<p><code>drop index index_name &lt;cascade / restricte&gt;</code></p>
<pre><code>// e.g.
create unique index test_index on
test_table(sno, sname);

drop index test_index;
</code></pre>
<h3 id="sql-数据查询">SQL 数据查询</h3>
<p>select 语法很多，具体内容介绍在众多教程网站上也有很多。这里的笔记就是针对比较常见的 student 表进行的各类操作实例，以此复习各类 select 语法。</p>
<pre><code>// e.g.

// 从 student 表中选取 sno 与 sname
select sno, sname from student;

// 从 student 表中选取所有
select * from student;

// 从 student 表中选取 sage 并减 2015；选取 sname 并小写，输出时重命名为 NAME
select sage-2015, lower(sname) NAME from student;

// 从 student 表中选取 sno 的和，并计 sname 数
select sum(sno), count(sname) from student;

// 从 student 表中选取 sno 并去除重复数据
select distinct sno from student;

// 从 student 表中选取 dno 为 cs 的 sname
select sname from student where dno = 'cs';

// 从 student 表中选取 dno 为 cs 或者 ms 的 sname
select sname from studnet where dno in ('cs','ms');

// 从 student 表中选取 sname 倒数第二位为 l 的 sno
select sno from student where sname like '%l_';

// 从 student 表中选取 sname 最后一位为 _ 的 sno
select sno from student where
	sname like '%\_' escape \;

// 从 student 表中选取 sno = 6 的sname
select sname from student where
	(sno&gt;10 or sno&lt;5) and sno=6;

// 从 student 表中选取 cno 为 3 的 sname 并按照 grade, sno 排序
select sname from student where cno='3'
	order by grade desc/asc, sno desc/asc;

// student 表中不同 sname 数
select count(distinct sname) from studnet;

// 从 student 表中选取 sno 与对应的平均成绩
select sno, avg(grade) from student group by sno;

// 从 student 表中选取挂两科以上的学生
select sno from student where grade&lt;60
	group by sno having count(*)&gt;2;
	select student.*, sc.* from student, sc where
	student.sno = sc.sno;

// 同表连接
select first.sno, second.con from
	test first, test second where ~;

// 异表 join
select * from table1 left outer join table2 on...
	/right outer join on... /full outer join on...

// 从 student 表中选取大于平均成绩的 sno 与 cno
select sno, cno from sc x where grade &gt;=
	(select ave(grade) from sc y where x.sno=y.sno)

// 从 student 表中选取 con 有 1 的 sname
select sname from student where exists
	(select * from sc where student.sno=sno and cno='1');

// 两层 not exists
select sname from student where not exists
	(select * from course where not exists
		(select * from sc where sno=student.sno
			and cno=course.cno
		) //course that student didnt choose
	);

// 两层 not exists
select distict sno from sc x where not exists
	(select * from sc y where sno=001 and not eixsts
		(select * form sc z where z.sno=x.sno
			and z.cno=y.cno
		) //course that they all chosed
	);

// 不同 select 的结合
select_1 union/union all select_2;
select_1 intersect select_2;
select_1 except select_2;

// 临时表
select sno, cno from sc,
	(select sno, avg(grade) from sc group by sno)
	as avg(avg_sno, avg_grade)
	where sc.sno=avg.avg_sno
	and sc.grade&gt;avg.avg_grade;
</code></pre>
<h3 id="sql-数据更新">SQL 数据更新</h3>
<pre><code>// e.g.

// 插入数据
insert into student(sno, sname) values(002, zerotwo);

// 从另一个表选中数据插入
insert into student(sno, sname) 
    select sno, sname from other_tabel;

// 更新数据
update student set sage=22 where sno=002;

// 选择性更新数据
update sc set grade=100 where 'ma'=
	(select dno from student where student.sno=sc.sno);
</code></pre>
<p>除此之外还有 delete 等各类操作，都是大同小异。</p>
<h2 id="数据库编程">数据库编程</h2>
<blockquote>
<p>SQL 编程技术可以有效克服 SQL 语言实现复杂应用方面的不足，提高应用系统和数据库管理系统之间的互操作性。</p>
</blockquote>
<p>SQL 编程来访问和管理数据库中数据的方式主要有：</p>
<ul>
<li>嵌入式 SQL (ESQL)</li>
<li>过程化 SQL (PL/SQL)</li>
<li>存储过程和自定义函数</li>
<li>开放数据库互联 (ODBC) etc.</li>
</ul>
<p><strong>嵌入式 SQL ：</strong></p>
<p>实例：（更为完善的例子在书上 page.247）</p>
<pre><code>// e.g.

exec sql begin declare section; // 声明主变量
char sno;
char cno;
char sname;
exec sql end declare section;

exec sql include sqlca; // sql通信区
int main(){
	...
	exec sql connect to database_1; // 连接数据库
	exec sql declare v cursor for // 声明游标v，指向select的表
		select...
	exec sql open v;
	for(;;){
		exec sql fetch v into :sno, :cno, :sname; // 推进游标
		if(sqlca.sqlcode != 0) break;
		... // 可以各种操作，也可以内嵌sql语句
	}
	exec sql close v; // 关闭游标
	exec sql commit work; // 提交事务
	exec sql disconnect database_1; // 关闭数据库连接
	return 0;
}
</code></pre>
<p>由于学期课程中并没有涉及太多的数据库编程部分，这边就先空下来，后来有空了再补充。</p>
<h2 id="数据库的完整性">数据库的完整性</h2>
<p><strong>三种数据完整性：</strong></p>
<p>实体完整性：(primary key)</p>
<pre><code>// e.g.
sno char(10) primary key; // 列级定义主码
primary key(sno, cno); // 表级定义主码
</code></pre>
<p>参照完整性：(foreign key)</p>
<pre><code>// e.g.
foreign key(sno) references student(sno)
    on delete/update cascade;
foreign key(cno) references studnet(cno)
    on delete no action;
</code></pre>
<p>用户定义完整性：</p>
<pre><code>// e.g.
sno char(10) not null; // 设置 sno 非空
cno char(10) nuique; // 设置 cno 非重复

check(sex in('mail', 'famail')); // 设置 sex ‘选项’
check(sex='famail' or sname not like'ms.%');
</code></pre>
<p><strong>对数据库完整性的操作：</strong></p>
<p>完整性约束</p>
<pre><code>// e.g.
sno char(3) constrant c1 &lt;...&gt;; // 命名约束，把设置给 sno 的完整性约束命名为 c1
alter table student
    add constraint c1 &lt;...&gt;; // 修改约束
</code></pre>
<p>断言</p>
<pre><code>// e.g.
create assertion [assertion_name] &lt;sql...&gt;;
</code></pre>
<p>触发器</p>
<pre><code>// e.g.
create trigger [trigger_name] &lt;sql...&gt;;
</code></pre>
<p>关于检查约束、断言与触发器的区别：</p>
<ul>
<li>
<p>检查约束：检查是一个SQL，它确保在记录上执行操作之前满足条件；</p>
</li>
<li>
<p>断言：断言是一条SQL，它确保条件满足或停止对数据库对象执行的操作；</p>
</li>
<li>
<p>触发器：触发器是在数据库中更新，插入或删除之前或之后执行的一段SQL；</p>
</li>
</ul>
<h2 id="数据库安全性">数据库安全性</h2>
<p><strong>常通过下面几种方式控制数据库安全性：</strong></p>
<p>用户识别：即最常见的‘登陆’控制。</p>
<p>存取控制：自主存取控制(DAC)、强制存取控制(MAC)。</p>
<pre><code>// e.g. DAC

grant select on table table_1 to user_1; // 授予权限
grant all priviliges on table student, course
    to user_2, user_3; // 授予全部权限
grant select on table table_1 to public; // 授予角色权限
grant update(sno) on table table_1 to user_1;
    with grant option; // 授予可再授权权限

revoke select on table table_1 from user_1
    cascade/restrict; // 收回可再授权权限需要cascade
</code></pre>
<pre><code>// e.g. MAC
// 包含 主体：许可证级别；客体：密级，并满足：
* 仅当主体的许可证级别大于或等于客体的密级时，该主体才能读相应的客体；
* 仅当主体的许可证级别小于或等于客体的密级时，该主体才能写相应的客体；
</code></pre>
<p>视图：前面已大致介绍；</p>
<p>审计：用户级审计 &amp; 系统级审计；</p>
<p>加密：常见；</p>
<h2 id="关系数据理论">关系数据理论</h2>
<blockquote>
<p>关系数据理论涉及了不少逻辑相关，学习的时候觉得很奇妙，尤其是其中的公理系统和以之推出来的最小依赖集求法；我的笔记中只记下了便于复习的提纲，所以较细致的部分还需要参考书上内容。</p>
</blockquote>
<p><strong>关系模式</strong> R(U, D, DOM, F)</p>
<ul>
<li>R：关系名</li>
<li>U：组成该关系的属性名集合</li>
<li>D：属性组U中属性所来自的域</li>
<li>DOM：属性向域的映象集合</li>
<li>F：属性间数据的依赖关系集合</li>
</ul>
<p><strong>依赖关系</strong> （重要）</p>
<ul>
<li>函数依赖（FD）：
关系 x, y; 若 x1 != x2 能推出 y1 != y2，则称 y 函数依赖于 x。
<ul>
<li>平凡依赖 / 非平凡依赖；</li>
<li>完全函数依赖（F）/ 部分函数依赖（P）；</li>
<li>传递函数依赖 / 直接依赖；</li>
</ul>
</li>
<li>多值依赖（MVD）：
R(U)上关系r，给定的一对（x，z）值，有一组Y的值，这组值仅仅决定于x值而与z值无关，记x-&gt;-&gt;y;
<ul>
<li>平凡依赖 / 非平凡依赖；</li>
</ul>
</li>
</ul>
<p><strong>码</strong>（复习）</p>
<ul>
<li>候选码：可以唯一确定元组的一组属性就是<strong>一个</strong>候选码，<em>但其真子集无法唯一确定元组</em> ，候选码中不止一组属性</li>
<li>主码：候选码中任意一组</li>
<li>超码：可以唯一确定元组的一组属性就是一个超码，超码中不止一组属性</li>
<li>外码：属性中引用的其他实体的主码</li>
</ul>
<blockquote>
<p>候选码是最小超码，主码是候选码的其中一个</p>
</blockquote>
<p><strong>范式</strong>（重要）</p>
<ul>
<li>1NF：所有属性不可分解；</li>
<li>2NF：非主属性完全函数依赖于主码</li>
<li>3NF：非主属性既不部分依赖于码也不传递依赖于码（仅要求最外层是非主属性）；</li>
<li>BCNF：每一个决定属性因素都包含码：
<ul>
<li>所有非主属性对每一个码都是完全函数依赖；</li>
<li>所有的主属性对每一个不包含它的码，也是完全函数依赖；</li>
<li>没有任何属性完全函数依赖于非码的任何一组属性；</li>
</ul>
</li>
<li>4NF：每个非平凡多值依赖 X→→Y（Y不属于X），X都含有码：
<ul>
<li>不允许有非平凡且非函数依赖的多值依赖</li>
<li>允许的非平凡多值依赖是函数依赖</li>
</ul>
</li>
</ul>
<p>范式推导：</p>
<ul>
<li>1NF -&gt; 2NF：消除非主属性对码的部分函数依赖</li>
<li>2NF -&gt; 3NF：消除非主属性对码的传递函数依赖</li>
<li>3NF -&gt; BCNf：消除主属性对码的部分和传递函数依赖，此时已经实现了函数依赖范围内的彻底分解</li>
<li>BCDF -&gt; 4NF：消除非平凡且非函数依赖的多值依赖</li>
</ul>
<p><strong>数据依赖的公理系统</strong></p>
<ul>
<li>逻辑蕴含：对于满足一组函数依赖 F 的关系模式 R&lt;U,F&gt;，其任何一个关系 r 若函数依赖 X→Y 都成立,（即 r 中任意两元组 t, s,若 t<input checked="" disabled="" type="checkbox"> =s<input checked="" disabled="" type="checkbox"> ,则 t[Y]=s[Y]）,则称 F 逻辑蕴含 X→Y;</li>
<li>Armstrong公理系统：
<ul>
<li>自反律： y in x in u =&gt; x-&gt;y in F</li>
<li>增广律： x-&gt;y z in u =&gt; xz-&gt;yz</li>
<li>传递律： x-&gt;y y-&gt;z =&gt; x-&gt;z</li>
</ul>
</li>
<li>推理规则
<ul>
<li>合并规则： x-&gt;y x-&gt;z =&gt; x-&gt;yz</li>
<li>伪传递规则： x-&gt;y wy-&gt;z =&gt; xw-&gt;z</li>
<li>分解规则： x-&gt;y z in y =&gt; x-&gt;z</li>
</ul>
</li>
<li>函数的最小依赖集：
<ul>
<li>F 中任一函数依赖的右部仅含有一个属性</li>
<li>F 中不存在这样的函数依赖 X→A，使得 F 与 F-{X→A} 相等（即 F 中函数依赖不能由其中的其他函数依赖导出）</li>
<li>F 中不存在这样的函数依赖 X→A，X 中存在真子集 Z 使得 F-{X→A}∪{Z→A} 与 F 等价（即 F 中各函数左侧都是最小属性集中的）</li>
</ul>
</li>
<li>求候选码准则：
<ul>
<li>准则1：如果属性 A 只在 F 中各个函数依赖的左端出现，则 A 必是码中的属性</li>
<li>准则2：如果属性 A 只在 F 中各个函数依赖的右端出现，则 A 必不是码中的属性</li>
<li>准则3：如果 A 不在F的各个函数依赖中出现，则 A 必不是码中的属性</li>
</ul>
</li>
<li>求候选码方法：
<ul>
<li>根据准则3：把不在 F 中出现的各个函数依赖中出现的属性去掉，因为这些属性一般对模型没什么意义</li>
<li>根据准则1：确定码中必须有的属性集（设为 M ）</li>
<li>根据准则2：去掉码中肯定没有的属性</li>
<li>确定余下的属性集（设为 W ）</li>
<li>从属性 M 开始，令 K=M，如果 KF +=U，K 就是候选码。否则从W选择属性加入到 K 中，直到 KF +=U，K 就是候选码（注意可能有多个候选码）</li>
</ul>
</li>
</ul>
<pre><code class="language-sql">// e.g. 求函数最小依赖集实例
F = { A → BC ， B → AC ， C → A }，求 Fmin

{
	[step.1]
	F= { A → B ， A → C ， B → A，B  → C，C → A }

	[step.2]
	G=F-{ A → B }
		AG += AC，不包含 B，所以 A → B 保留
	G=F-{ A → C }
		AG += ABC，包含 C，所以 A → C 删除，令 F=G ，
		F={A → B ， B → A，B  → C， C → A}
	G=F-{ B → A }，
		BG += BAC，包含A，所以 B → A 删除，令F=G，F={A → B，BC， C → A}
	G=F-{ B → C }，
		BG +=B，不包含 C，所以 B → C 保留
	G=F-{ C → A }，
		CG += C，不包含 A，所以 C → A 保留

	[step.3]
	F={ A → B ，B → C ，C → A }
}
</code></pre>
<h2 id="数据库设计">数据库设计</h2>
<ol>
<li>需求分析阶段：了解分析用户需求 (数据 and 处理)；</li>
<li>概念结构设计：综合归纳用户需求形成概念模型，形成概念模式 (E-R)；</li>
<li>逻辑结构设计：概念模型转化为数据模型并优化，形成逻辑模式，进一步优化为外模式；</li>
<li>物理结构设计：选定储存结构和存取方法，形成内模式；</li>
<li>数据库实施：建立数据库、编制程序、数据入库、调试运行；</li>
<li>数据库运行与维护：及时评价、调整、修改；</li>
</ol>
<h2 id="数据库恢复">数据库恢复</h2>
<p>事务：是用户定义的一个 <em>数据库操作序列</em> ，这些操作要么都做，要么都不做，是一个不可分割的工作单位，恢复和并发控制的基本单位；</p>
<p>事务的性质：</p>
<ul>
<li>原子性：要么全做要么不做；</li>
<li>一致性：要么写入正确的结果，要么不写入；</li>
<li>隔离性：详看并发控制（关于交叉进行）；</li>
<li>持续性：commit之后修改是持久的；</li>
</ul>
<p>故障：</p>
<ul>
<li>事务故障：逻辑故障、完整性约束下的中止事务；</li>
<li>系统故障：停电、死机；</li>
<li>介质故障：储存盘损坏；</li>
<li>病毒：病毒攻击；</li>
</ul>
<p>备份：</p>
<ul>
<li>动态备份 / 静态备份；</li>
<li>海量备份 / 增量备份；</li>
</ul>
<p>恢复策略：</p>
<ul>
<li>事务故障：反向扫描log，按步骤恢复至故障事务开始的标记；</li>
<li>系统故障：
<ul>
<li>log中有记录 commit：redo，正向扫描；</li>
<li>log中无记录 commit：undo，操作同事务故障；</li>
</ul>
</li>
<li>介质故障：恢复数据库并常规使用 log 恢复；</li>
</ul>
<p>检查点技术：checkpoints文件记录当时所有事务清单和最近的log的地址，redo文件记录检查点位置，可以提高故障恢复效率；</p>
<ul>
<li>记录：日志写入-&gt;检查点写入-&gt;数据写入-&gt;重新开始文件写入；</li>
<li>恢复：重新开始文件找到最后检查点-&gt;事务清单上的事务进行审计-&gt;正向扫描log，无 commit：undo，有 commit：redo；</li>
</ul>
<h2 id="并发控制">并发控制</h2>
<p>面对的三种问题：丢失修改、不可重复读、读取脏数据；</p>
<p>事务执行：事务串行执行、交叉并发执行(单机)、同时并发执行(多机)；</p>
<p>技术：排他锁(X) read &amp; write &amp; 共享锁(S) read only；</p>
<p>封锁协议：</p>
<ul>
<li>一级封锁协议：修改前加上X锁，可以防止丢失修改，不能保证可重复读和脏数据；</li>
<li>二级封锁协议：一级封锁基础上，读取前加上S锁（到读取结束），可以防止丢失修改和脏数据，不能保证可重复读；</li>
<li>三级封锁协议：一级封锁基础上，读取前加上S锁（直到事务结束），可以防止三种问题；</li>
</ul>
<p>活锁 &amp; 死锁：</p>
<ul>
<li>活锁：一个事务持续等待，没有逻辑上锁死；</li>
<li>死锁：逻辑上锁死；预防或诊断解除（超时法、事务等待图法）；</li>
</ul>
<p>可串行化调度：多个事务的并发执行是正确的，当且仅当其结果与按某一次序串行地执行这些事务时的结果相同。可串行化调度当然也保持数据库的一致状态；</p>
<p>可串行性：是并发事务正确调度的准则。在RDBMS中，作为并发控制的正确性准则。一个给定的并发调度，当且仅当它是可串行化的，才认为是正确调度；</p>
<p>两段锁协议（可串行化的充分条件，但并不保证避免死锁）：</p>
<ul>
<li>第一阶段：获得封锁（扩展阶段）；</li>
<li>第二阶段：释放封锁（收缩阶段）；</li>
</ul>
<p>粒度：封锁对象的大小，区别为逻辑单元和物理单元；</p>
<p>多粒度封锁：同时支持多种封锁粒度；</p>
<p>多粒度封锁协议：</p>
<ul>
<li>允许对多粒度树中的每个节点独立加锁；</li>
<li>节点加锁意味着所有后裔加锁；</li>
<li>显示封锁 / 隐式封锁（因上一条引起）；</li>
</ul>
<blockquote>
<p>多粒度封锁效率低，因为它需要检查上下所有节点的加锁情况</p>
</blockquote>
<p>意向锁（如果对一个结点加意向锁，则说明该结点的下层结点正在被加锁，对任一结点加基本锁，必须先对它的上层结点加意向锁）：</p>
<ul>
<li>意向共享锁（IS）：后裔拟加S锁；</li>
<li>意向排他锁（IX）：后裔拟加X锁；</li>
<li>共享意向排他锁（SIX）：S+IX的效果（意思是要读整个表并且可能更新一些数据）；</li>
</ul>
<blockquote>
<p>申请封锁自上而下，释放封锁自下而上。</p>
</blockquote>
<h2 id="关系查询处理和查询优化">关系查询处理和查询优化</h2>
<p>查询分析：查询语句的语义分析；</p>
<p>查询检查：安全性检查 &amp; 完整性检查；</p>
<p>查询优化：</p>
<ul>
<li>代数优化：关系代数表达式的优化；<em>此处内容较多，详看书本 page.281</em></li>
<li>物理优化：
<ul>
<li>基于规则的启发式优化
<ul>
<li>选择操作
<ol>
<li>小关系：全表扫描</li>
<li>主码相关：主码索引</li>
<li>非主属性：比例较小索引，较大全表</li>
<li>非等值或者范围：同上</li>
<li>OR：一般全表</li>
</ol>
</li>
<li>连接操作
<ol>
<li>已按照连接属性排序：排序-合并方法</li>
<li>连接属性上有索引：索引连接法</li>
<li>其中一个表比较小：HASH join方法</li>
</ol>
</li>
</ul>
</li>
<li>基于代价估算的优化
<ul>
<li>代价估计：
<ol>
<li>全表B块，全表扫描cost=B</li>
<li>全表B块，选择条件码值对应，平均搜索cost=B/2</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li>基于代价估计的优化</li>
</ul>
<h1 id="结尾">结尾</h1>
<p>对照书上看了一看，发现学的是真的粗糙，像数据库编程、数据库安全都很粗略地看了过去，学习过程中也没有实际做出什么东西来，这份笔记涉及的部分也差了很多，只是为了通过期末考试。</p>
<p>因为学期的课程讲到关系查询就结束了，所以之后的内容如管理系统、大数据部分，在课程和复习中只大致浏览过。</p>
<p>如果未来有用到数据库的内容，那么再复习并更新这篇文章。</p>

    </div>
    <div class="article-footer">
    </div>
  </article>
<section id="comments">
</section>

</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="https://chuanbohua.github.io/post/2018-05-05-windows-app/" title="Windows 常用软件记录"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            <li class="next">
                <a href="https://chuanbohua.github.io/post/2018-07-27-vol-moe/"
                    title="爬取 Vol.moe 的漫画资源"><span>Newer&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="Catalogue" role="button">
                    <span>[&nbsp;</span><span>Catalogue</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter"
                data-mobile-sites="weibo,qq,qzone"></div>
        </div>
    </div>
</nav>

</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/chuanbohua" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://chuanbohua.github.io/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
    <li><a href="https://twitter.com/huachuanbo" target="_blank" title="twitter" data-toggle=tooltip data-placement=top >
            <i class="icon icon-twitter"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2017  -
    2020 Timegg
    
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/python.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/javascript.min.js" defer></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="https://chuanbohua.github.io/js/application.min.bdeb64b910570b6c41badc6a05b7afb0c8ad9efd8525de3c7257d59e786326a3.js"></script>
<script src="https://chuanbohua.github.io/js/plugin.min.51ff8c7317566f82259170fa36e09c4493adc9b9378b427a01ad3f017ebac7dd.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            ROOT_URL: 'https:\/\/chuanbohua.github.io\/',
            CONTENT_URL: 'https:\/\/chuanbohua.github.io\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="https://chuanbohua.github.io/js/insight.min.a343cd9a5a7698336b28ef3a7c16a3a1b1d2d5fb17dc8ed04022bbe08cc5459073a15bdafa3a8a58cdd56080784bdd69fa70b1ae8597565c799c57ed00f0e120.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-164502321-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
